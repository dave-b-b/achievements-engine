"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[871],{8453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const s={},c=i.createContext(s);function r(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(c.Provider,{value:n},e.children)}},8531(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"guides/event-based-tracking","title":"Event-Based Tracking","description":"achievements-engine is built on an event-driven architecture. This guide explains how to leverage the event system for tracking achievements and reacting to state changes.","source":"@site/docs/guides/event-based-tracking.md","sourceDirName":"guides","slug":"/guides/event-based-tracking","permalink":"/achievements-engine/docs/guides/event-based-tracking","draft":false,"unlisted":false,"editUrl":"https://github.com/dave-b-b/achievements-engine/tree/main/docs/docs/guides/event-based-tracking.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Direct Metric Updates","permalink":"/achievements-engine/docs/guides/direct-updates"},"next":{"title":"Error Handling","permalink":"/achievements-engine/docs/guides/error-handling"}}');var s=t(4848),c=t(8453);const r={sidebar_position:5},a="Event-Based Tracking",l={},o=[{value:"Listening to Built-in Events",id:"listening-to-built-in-events",level:2},{value:"Subscribing to Events",id:"subscribing-to-events",level:3},{value:"Unsubscribing from Events",id:"unsubscribing-from-events",level:3},{value:"One-Time Listeners",id:"one-time-listeners",level:3},{value:"Event Types",id:"event-types",level:3},{value:"Using <code>eventMapping</code> for Metric Updates",id:"using-eventmapping-for-metric-updates",level:2},{value:"Direct String Mapping",id:"direct-string-mapping",level:3},{value:"MetricUpdater Function",id:"metricupdater-function",level:3},{value:"Complete Example",id:"complete-example",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"event-based-tracking",children:"Event-Based Tracking"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"achievements-engine"})," is built on an event-driven architecture. This guide explains how to leverage the event system for tracking achievements and reacting to state changes."]}),"\n",(0,s.jsx)(n.p,{children:"There are two main ways to use events:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Listening to built-in events"}),": React to events that the engine emits, such as ",(0,s.jsx)(n.code,{children:"achievement:unlocked"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Using ",(0,s.jsx)(n.code,{children:"eventMapping"})]}),": Emit your own custom events to update metrics, decoupling your application logic from the achievement system."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"listening-to-built-in-events",children:"Listening to Built-in Events"}),"\n",(0,s.jsx)(n.p,{children:"The engine emits four core events:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"achievement:unlocked"})}),": Fired when an achievement is unlocked."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"metric:updated"})}),": Fired when a metric value changes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"state:changed"})}),": Fired after any state change (metrics or achievements)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"error"})}),": Fired when an error occurs."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"subscribing-to-events",children:"Subscribing to Events"}),"\n",(0,s.jsxs)(n.p,{children:["You can use ",(0,s.jsx)(n.code,{children:"engine.on()"})," to subscribe to these events."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AchievementEngine } from 'achievements-engine';\n\nconst engine = new AchievementEngine({\n  achievements,\n  storage: 'localStorage'\n});\n\n// Listen for achievement unlocks\nengine.on('achievement:unlocked', (event) => {\n  console.log(`\ud83c\udf89 ${event.achievementTitle}`);\n  // e.g., show a notification\n});\n\n// Listen for metric updates\nengine.on('metric:updated', (event) => {\n  console.log(`${event.metric}: ${event.oldValue} \u2192 ${event.newValue}`);\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"unsubscribing-from-events",children:"Unsubscribing from Events"}),"\n",(0,s.jsxs)(n.p,{children:["It's important to unsubscribe from events to prevent memory leaks. The ",(0,s.jsx)(n.code,{children:"on"})," method returns an ",(0,s.jsx)(n.code,{children:"unsubscribe"})," function."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const unsubscribe = engine.on('achievement:unlocked', (event) => {\n  console.log('Achievement unlocked!');\n});\n\n// Later, to stop listening:\nunsubscribe();\n"})}),"\n",(0,s.jsx)(n.h3,{id:"one-time-listeners",children:"One-Time Listeners"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"engine.once()"})," to listen for an event just once."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"engine.once('achievement:unlocked', (event) => {\n  console.log('First achievement unlocked!', event.achievementTitle);\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"event-types",children:"Event Types"}),"\n",(0,s.jsxs)(n.p,{children:["Each event has a specific payload with detailed information. For example, the ",(0,s.jsx)(n.code,{children:"AchievementUnlockedEvent"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface AchievementUnlockedEvent {\n  achievementId: string;\n  achievementTitle: string;\n  achievementDescription: string;\n  achievementIconKey?: string;\n  timestamp: number;\n}\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"using-eventmapping-for-metric-updates",children:["Using ",(0,s.jsx)(n.code,{children:"eventMapping"})," for Metric Updates"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"eventMapping"})," feature allows you to automatically update metrics by emitting your own custom events. This is a powerful way to decouple your application logic from the achievement system."]}),"\n",(0,s.jsx)(n.h3,{id:"direct-string-mapping",children:"Direct String Mapping"}),"\n",(0,s.jsx)(n.p,{children:"Map an event name directly to a metric name."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const engine = new AchievementEngine({\n  achievements,\n  storage: 'localStorage',\n  eventMapping: {\n    'enemy:defeated': 'enemiesDefeated',\n    'item:collected': 'itemsCollected'\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Emitting Events:"}),"\nInstead of ",(0,s.jsx)(n.code,{children:"engine.update()"}),", you use ",(0,s.jsx)(n.code,{children:"engine.emit()"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// This will update the 'enemiesDefeated' metric\nengine.emit('enemy:defeated', 10); // The new value is 10\n\n// This will update the 'itemsCollected' metric\nlet items = 0;\nitems++;\nengine.emit('item:collected', items);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"metricupdater-function",children:"MetricUpdater Function"}),"\n",(0,s.jsx)(n.p,{children:"For more complex logic, use a function to transform event data into metric updates."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import type { MetricUpdater } from 'achievements-engine';\n\nconst levelUpUpdater: MetricUpdater = (eventData, currentMetrics) => {\n  const currentLevel = currentMetrics.level || 0;\n  return {\n    level: currentLevel + 1,\n    experience: 0 // Reset experience on level up\n  };\n};\n\nconst engine = new AchievementEngine({\n  achievements,\n  storage: 'localStorage',\n  eventMapping: {\n    'player:levelup': levelUpUpdater,\n    'player:gain_exp': (eventData, currentMetrics) => {\n      const currentExp = currentMetrics.experience || 0;\n      return { experience: currentExp + eventData.amount };\n    }\n  }\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Emitting Events:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"engine.emit('player:levelup');\nengine.emit('player:gain_exp', { amount: 50 });\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsxs)(n.p,{children:["Here's a full example that uses both listening to events and ",(0,s.jsx)(n.code,{children:"eventMapping"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// achievements.ts\nexport const gameAchievements = {\n  enemiesDefeated: {\n    10: { title: 'Novice Slayer', description: 'Defeat 10 enemies' },\n  },\n  level: {\n    5: { title: 'Level 5', description: 'Reach level 5' },\n  }\n};\n\n// engine.ts\nimport { AchievementEngine } from 'achievements-engine';\nimport { gameAchievements } from './achievements';\n\nconst engine = new AchievementEngine({\n  achievements: gameAchievements,\n  storage: 'localStorage',\n  eventMapping: {\n    'enemy:defeated': 'enemiesDefeated',\n    'player:levelup': (eventData, currentMetrics) => {\n      const currentLevel = currentMetrics.level || 0;\n      return { level: currentLevel + 1 };\n    }\n  }\n});\n\n// Listen for unlocks\nengine.on('achievement:unlocked', (event) => {\n  console.log(`\ud83c\udf89 Achievement Unlocked: ${event.achievementTitle}`);\n});\n\nexport default engine;\n\n// game.ts\nimport engine from './engine';\n\nclass Game {\n  private enemiesDefeated = 0;\n\n  defeatEnemy() {\n    this.enemiesDefeated++;\n    engine.emit('enemy:defeated', this.enemiesDefeated);\n  }\n\n  levelUp() {\n    engine.emit('player:levelup');\n  }\n}\n\n// Usage\nconst game = new Game();\ngame.defeatEnemy(); // emits 'enemy:defeated', which updates the metric\ngame.levelUp(); // emits 'player:levelup', which updates the metric\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);